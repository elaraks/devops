- name: ansible host - clean timemap repo state
  local_action:
    module: file
    state: absent
    path: timemap

- name: create credentials folder if it does not already exist
  file:
    path: credentials
    state: directory

- name: ansible host - checkout timemap repo
  local_action:
    module: git
    repo: 'https://github.com/forensic-architecture/timemap'
    dest: timemap
    version: develop

- name: copy config.js to timemap
  local_action:
    module: template
    src: templates/timemap_config.js.j2
    dest: timemap/config.js

- name: install packages on ansible host
  local_action:
    module: yarn
    path: timemap
    state: latest

- name: ansible host - build app
  local_action:
    module: shell
    _raw_params: yarn build
    chdir: timemap

- name: server - remove previous frontend if exists
  file:
    state: absent
    path: '{{ static_files_folder }}/{{ application_name }}'

- name: copy config.js to credentials folder
  copy:
    src: timemap/config.js
    dest: credentials/{{ application_name }}_config.js

- name: copy files from timemap build to server's static files folder
  copy:
    src: timemap/build/
    dest: '{{ static_files_folder }}/{{ application_name }}'


- name: ansible host - remove timemap repo
  local_action:
    module: file
    state: absent
    path: timemap
